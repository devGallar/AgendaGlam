"use strict";App.Pages.Secretaries=function(){function remove(id){App.Http.Secretaries.destroy(id).done(function(){App.Layouts.Backend.displayNotification(lang("secretary_deleted")),App.Pages.Secretaries.resetForm(),App.Pages.Secretaries.filter($("#filter-secretaries .key").val())})}function resetForm(){$filterSecretaries.find(".selected").removeClass("selected"),$filterSecretaries.find("button").prop("disabled",!1),$filterSecretaries.find(".results").css("color",""),$secretaries.find(".record-details").find("input, select, textarea").val("").prop("disabled",!0),$secretaries.find(".record-details .form-label span").prop("hidden",!0),$secretaries.find(".record-details #calendar-view").val("default"),$secretaries.find(".record-details #timezone").val(vars("default_timezone")),$secretaries.find(".record-details #language").val(vars("default_language")),$secretaries.find(".record-details #notifications").prop("checked",!0),$secretaries.find(".add-edit-delete-group").show(),$secretaries.find(".save-cancel-group").hide(),$secretaries.find(".form-message").hide(),$secretaries.find(".is-invalid").removeClass("is-invalid"),$("#edit-secretary, #delete-secretary").prop("disabled",!0),$("#secretary-providers input:checkbox").prop("disabled",!0).prop("checked",!1)}function filter(keyword){var selectId=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,show=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];App.Http.Secretaries.search(keyword,filterLimit).done(function(response){filterResults=response,$filterSecretaries.find(".results").empty(),response.forEach(function(secretary){$filterSecretaries.find(".results").append(App.Pages.Secretaries.getFilterHtml(secretary)).append($("<hr/>"))}),response.length?response.length===filterLimit&&$("<button/>",{type:"button",class:"btn btn-outline-secondary w-100 load-more text-center",text:lang("load_more"),click:function click(){filterLimit+=20,App.Pages.Customers.filter(keyword,selectId,show)}}).appendTo("#filter-secretaries .results"):$("#filter-secretaries .results").append($("<em/>",{text:lang("no_records_found")})),selectId&&select(selectId,show)})}function select(id){var show=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if($filterSecretaries.find(".selected").removeClass("selected"),$("#filter-secretaries .secretary-row[data-id=\""+id+"\"]").addClass("selected"),show){var secretary=filterResults.find(function(filterResult){return+filterResult.id===+id});App.Pages.Secretaries.display(secretary),$("#edit-secretary, #delete-secretary").prop("disabled",!1)}}var $secretaries=$("#secretaries"),$id=$("#id"),$firstName=$("#first-name"),$lastName=$("#last-name"),$email=$("#email"),$mobileNumber=$("#mobile-number"),$phoneNumber=$("#phone-number"),$address=$("#address"),$city=$("#city"),$state=$("#state"),$zipCode=$("#zip-code"),$notes=$("#notes"),$language=$("#language"),$timezone=$("#timezone"),$ldapDn=$("#ldap-dn"),$username=$("#username"),$password=$("#password"),$passwordConfirmation=$("#password-confirm"),$notifications=$("#notifications"),$calendarView=$("#calendar-view"),$filterSecretaries=$("#filter-secretaries"),filterResults={},filterLimit=20;return document.addEventListener("DOMContentLoaded",function initialize(){App.Pages.Secretaries.resetForm(),App.Pages.Secretaries.filter(""),App.Pages.Secretaries.addEventListeners(),vars("providers").forEach(function(provider){var checkboxId="provider-service-".concat(provider.id);$("<div/>",{class:"checkbox",html:[$("<div/>",{class:"checkbox form-check",html:[$("<input/>",{id:checkboxId,class:"form-check-input",type:"checkbox","data-id":provider.id,prop:{disabled:!0}}),$("<label/>",{class:"form-check-label",text:provider.first_name+" "+provider.last_name,for:checkboxId})]})]}).appendTo("#secretary-providers")})}),{filter:filter,save:function save(secretary){App.Http.Secretaries.save(secretary).done(function(response){App.Layouts.Backend.displayNotification(lang("secretary_saved")),App.Pages.Secretaries.resetForm(),$("#filter-secretaries .key").val(""),App.Pages.Secretaries.filter("",response.id,!0)})},remove:remove,validate:function validate(){$("#secretaries .is-invalid").removeClass("is-invalid"),$secretaries.find(".form-message").removeClass("alert-danger");try{var missingRequired=!1;if($secretaries.find(".required").each(function(index,requiredField){$(requiredField).val()||($(requiredField).addClass("is-invalid"),missingRequired=!0)}),missingRequired)throw new Error(lang("fields_are_required"));if($password.val()!==$passwordConfirmation.val())throw $("#password, #password-confirm").addClass("is-invalid"),new Error(lang("passwords_mismatch"));if($password.val().length<vars("min_password_length")&&""!==$password.val())throw $("#password, #password-confirm").addClass("is-invalid"),new Error(lang("password_length_notice").replace("$number",vars("min_password_length")));if(!App.Utils.Validation.email($email.val()))throw $email.addClass("is-invalid"),new Error(lang("invalid_email"));var phoneNumber=$phoneNumber.val();if(phoneNumber&&!App.Utils.Validation.phone(phoneNumber))throw $phoneNumber.addClass("is-invalid"),new Error(lang("invalid_phone"));var mobileNumber=$mobileNumber.val();if(mobileNumber&&!App.Utils.Validation.phone(mobileNumber))throw $mobileNumber.addClass("is-invalid"),new Error(lang("invalid_phone"));if("true"===$username.attr("already-exists"))throw $username.addClass("is-invalid"),new Error(lang("username_already_exists"));return!0}catch(error){return $("#secretaries .form-message").addClass("alert-danger").text(error.message).show(),!1}},getFilterHtml:function getFilterHtml(secretary){var name=secretary.first_name+" "+secretary.last_name,info=secretary.email;return info=secretary.mobile_number?info+", "+secretary.mobile_number:info,info=secretary.phone_number?info+", "+secretary.phone_number:info,$("<div/>",{class:"secretary-row entry","data-id":secretary.id,html:[$("<strong/>",{text:name}),$("<br/>"),$("<small/>",{class:"text-muted",text:info}),$("<br/>")]})},resetForm:resetForm,display:function display(secretary){$id.val(secretary.id),$firstName.val(secretary.first_name),$lastName.val(secretary.last_name),$email.val(secretary.email),$mobileNumber.val(secretary.mobile_number),$phoneNumber.val(secretary.phone_number),$address.val(secretary.address),$city.val(secretary.city),$state.val(secretary.state),$zipCode.val(secretary.zip_code),$notes.val(secretary.notes),$language.val(secretary.language),$timezone.val(secretary.timezone),$ldapDn.val(secretary.ldap_dn),$username.val(secretary.settings.username),$calendarView.val(secretary.settings.calendar_view),$notifications.prop("checked",!!+secretary.settings.notifications),$("#secretary-providers input:checkbox").prop("checked",!1),secretary.providers.forEach(function(secretaryProviderId){var $checkbox=$("#secretary-providers input[data-id=\""+secretaryProviderId+"\"]");$checkbox.length&&$checkbox.prop("checked",!0)})},select:select,addEventListeners:function addEventListeners(){$secretaries.on("blur","#username",function(event){var $input=$(event.target);if(!0!==$input.prop("readonly")&&""!==$input.val()){var secretaryId=$input.parents().eq(2).find(".record-id").val();if(secretaryId){var username=$input.val();App.Http.Account.validateUsername(secretaryId,username).done(function(response){"false"===response.is_valid?($input.addClass("is-invalid"),$input.attr("already-exists","true"),$input.parents().eq(3).find(".form-message").text(lang("username_already_exists")),$input.parents().eq(3).find(".form-message").show()):($input.removeClass("is-invalid"),$input.attr("already-exists","false"),$input.parents().eq(3).find(".form-message").text()===lang("username_already_exists")&&$input.parents().eq(3).find(".form-message").hide())})}}}),$secretaries.on("submit","#filter-secretaries form",function(event){event.preventDefault();var key=$("#filter-secretaries .key").val();$filterSecretaries.find(".selected").removeClass("selected"),App.Pages.Secretaries.resetForm(),App.Pages.Secretaries.filter(key)}),$secretaries.on("click",".secretary-row",function(event){if($("#filter-secretaries .filter").prop("disabled"))return void $("#filter-secretaries .results").css("color","#AAA");var secretaryId=$(event.currentTarget).attr("data-id"),secretary=filterResults.find(function(filterResult){return+filterResult.id===+secretaryId});App.Pages.Secretaries.display(secretary),$("#filter-secretaries .selected").removeClass("selected"),$(event.currentTarget).addClass("selected"),$("#edit-secretary, #delete-secretary").prop("disabled",!1)}),$secretaries.on("click","#add-secretary",function(){App.Pages.Secretaries.resetForm(),$filterSecretaries.find("button").prop("disabled",!0),$filterSecretaries.find(".results").css("color","#AAA"),$secretaries.find(".add-edit-delete-group").hide(),$secretaries.find(".save-cancel-group").show(),$secretaries.find(".record-details").find("input, select, textarea").prop("disabled",!1),$secretaries.find(".record-details .form-label span").prop("hidden",!1),$("#password, #password-confirm").addClass("required"),$("#secretary-providers input:checkbox").prop("disabled",!1)}),$secretaries.on("click","#edit-secretary",function(){$filterSecretaries.find("button").prop("disabled",!0),$filterSecretaries.find(".results").css("color","#AAA"),$secretaries.find(".add-edit-delete-group").hide(),$secretaries.find(".save-cancel-group").show(),$secretaries.find(".record-details").find("input, select, textarea").prop("disabled",!1),$secretaries.find(".record-details .form-label span").prop("hidden",!1),$("#password, #password-confirm").removeClass("required"),$("#secretary-providers input:checkbox").prop("disabled",!1)}),$secretaries.on("click","#delete-secretary",function(){var secretaryId=$id.val(),buttons=[{text:lang("cancel"),click:function click(event,messageModal){messageModal.hide()}},{text:lang("delete"),click:function click(event,messageModal){remove(secretaryId),messageModal.hide()}}];App.Utils.Message.show(lang("delete_secretary"),lang("delete_record_prompt"),buttons)}),$secretaries.on("click","#save-secretary",function(){var secretary={first_name:$firstName.val(),last_name:$lastName.val(),email:$email.val(),mobile_number:$mobileNumber.val(),phone_number:$phoneNumber.val(),address:$address.val(),city:$city.val(),state:$state.val(),zip_code:$zipCode.val(),notes:$notes.val(),language:$language.val(),timezone:$timezone.val(),ldap_dn:$ldapDn.val(),settings:{username:$username.val(),notifications:+$notifications.prop("checked"),calendar_view:$calendarView.val()}};secretary.providers=[],$("#secretary-providers input:checkbox").each(function(index,checkbox){$(checkbox).prop("checked")&&secretary.providers.push($(checkbox).attr("data-id"))}),""!==$password.val()&&(secretary.settings.password=$password.val()),""!==$id.val()&&(secretary.id=$id.val()),App.Pages.Secretaries.validate()&&App.Pages.Secretaries.save(secretary)}),$secretaries.on("click","#cancel-secretary",function(){var id=$id.val();resetForm(),id&&select(id,!0)})}}}();